# FTP

ftp(file transfer protocol) 是用来在两台电脑之间传输数据的。 既然是传输数据，那用的传输层一般都是TCP（保证可靠性）

ftp分为两个步骤
- 两端建立连接，一端为客户端， 另一台为服务器端， 服务器端的连接端口为21
- 判断是主动模式还是被动模式， 进行数据传输

> 存在着两次TCP连接， 第一次TCP连接时建立control flow（控制流）， 第二次TCP连接时建立data flow（数据流）。我们讨论的主动或者被动只是在第二次连接有区别

![active mode]https://securitywing.com/wp-content/uploads/2013/07/active-FTP-mode.jpg)

先来看主动模式的步骤  
当进行完第一次连接时， 客户端会告诉服务端它开启了哪个端口用作数据流的传输。然后注意图片细节， 服务器会用20端口向其发出TCP连接请求，请求成功进行数据传输

这样的坏处在哪里呢？ 你想啊， 假如这台机子是在公司内网， 那由于是服务端主动发起的请求，当经过公司边界防火墙屏蔽掉。 那你说，我针对这个端口开通防火墙就好了。但该端口每次都是随机的，这给公司带来了很大的困扰

既然我们知道主动模式是服务端发起的， 那么被动模式，你应该知道是谁发起的了吧？

![passive mode](https://securitywing.com/wp-content/uploads/2013/07/FTP-passive-mode.jpg)

注意看图， 当进行第一次连接时， 客户端会给服务端发送一个`PASV`命令， 代表进行使用被动模式。然后服务端随机生成一个端口，发给客户端。 客户端主动从内网向该端口发起数据传输请求

可是你也会说， 那这样子服务端如果有防火墙的，也要开启相应通道啊？ 对的， 但是我们可以给服务端每次随机的端口设置一个范围，来增加安全性。

# FTPS
ftp协议是只用来数据传输的，不考虑数据的安全性，如果两端链路之间存在有人窃听的话，那么数据就会被盗走。 所以`ftps`类似于`https`， 利用了`SSL`来实现数据加密的功能

## ftp传输一个文件的时候快吗？
来自[FTP must die](http://mywiki.wooledge.org/FtpMustDie)中，有兴趣的同学可以参考

这里只说结论， 对于一个文件的传输， ftp需要大约10次round trip， 而http仅仅需要2次round trip。 如果传输很多文件的话， 则差异没那么大

# SFTP
首先 sftp 可以实现ftps同样的功能， 上传，下载和加密。 其次， 它是基于ssh的，它们仅需要使用ssh的22端口（所以在配置上方便快捷而且也降低了安全风险）。再者，该功能是直接镶嵌在ssh上的






